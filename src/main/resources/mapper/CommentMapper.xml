<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kitri.web_project.mybatis.mappers.CommentMapper">

<!--    <select id="getComments" parameterType="long" resultType="com.kitri.web_project.dto.comment.CommentDto">-->
<!--        SELECT free_board_comment.id as id, user_id as userId, content, created_at as createdAt,  like_count as likeCount,-->
<!--        nick_name as name-->
<!--        FROM free_board_comment join user on user.id = user_id-->
<!--        WHERE board_id = #{id}-->
<!--    </select>-->
    <select id="getTopLevelComments" parameterType="long" resultType="com.kitri.web_project.dto.comment.CommentDto">
        SELECT free_board_comment.id as id, user_id as userId, content, created_at as createdAt,  like_count as likeCount, nick_name as name,
               img_path as imgPath
        FROM free_board_comment join user on user.id = user_id
        WHERE parent_comment_id IS NULL
        AND board_id = #{id}
        ORDER BY created_at ASC
    </select>
    

    <select id="getChildComments" parameterType="long" resultType="com.kitri.web_project.dto.comment.CommentDto">
        SELECT free_board_comment.id as id, user_id as userId, content, created_at as createdAt,  like_count as likeCount, nick_name as name
        FROM free_board_comment join user on user.id = user_id
        WHERE parent_comment_id = #{parentCommentId}
        AND board_id = #{id}
        ORDER BY created_at ASC
    </select>

    <select id="getMyComments" parameterType="long" resultType="com.kitri.web_project.dto.comment.CommentDto">
        SELECT fbc.id as id, fbc.user_id as userId, fbc.board_id as boardId, fbc.content, fbc.created_at as createdAt, fbc.like_count as likeCount, fb.subject
        FROM free_board_comment fbc
        JOIN free_board fb ON fbc.board_id = fb.id
        WHERE fbc.user_id = #{id};
    </select>

    <insert id="addComment" parameterType="com.kitri.web_project.dto.comment.RequestComment">
        insert into free_board_comment (board_id, user_id, content)
        values (#{id}, #{userId}, #{content})
    </insert>

    <update id="editComment" parameterType="com.kitri.web_project.dto.comment.CommentDto">
        UPDATE free_board_comment SET content = #{content} WHERE id = #{id}
    </update>

    <delete id="deleteComment" parameterType="long">
        DELETE FROM free_board_comment WHERE id = #{commentId}
    </delete>

</mapper>